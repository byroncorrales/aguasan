{%extends "base.html"%}
{%block extra_js%}
<link rel="stylesheet" href="{{MEDIA_URL}}css/map.css" type="text/css" />
<script type="text/javascript" src="{{MEDIA_URL}}js/OpenLayers.js"></script>
<script type="text/javascript">
        var map, layer;

        function init(){
            //OpenLayers.ProxyHost="/proxy/?url=";
            map = new OpenLayers.Map('map');
            layer = new OpenLayers.Layer.WMS( "OpenLayers WMS",
                "http://labs.metacarta.com/wms/vmap0", {layers: 'basic'} );

            map.addLayer(layer);

            var markers = new OpenLayers.Layer.Markers( "Markers" );
            map.addLayer(markers);
            var size = new OpenLayers.Size(10,17);
            var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
            var icon = new OpenLayers.Icon('{{MEDIA_URL}}js/img/marker-gold.png',size,offset);
            
            //Añadimos los marcadores de proyecto.
            var url_json = '/ajax/ubicacion/donante/{{donante.id}}/' 
            $.getJSON(url_json, function(data){
                    $.each(data, function(i, item){
                        markers.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(item[0], item[1]),icon.clone()));
                        });
                    });

            map.zoomToMaxExtent();
            map.setCenter(new OpenLayers.LonLat(-85.24704, 12.987831), 7);
        }
    $(document).ready(function() {
            init();
            });
</script>
{%endblock%}
{%block contenido%}
 <div id="titulo">
                   Perfil de cooperante
 </div>
                   <div id="contenido_interno">
                    {%if donante.logo%}
                    <img src="{{MEDIA_URL}}/{{donante.logo}}"class="der">
                    {%endif%}
                    <div class="subtitulo_seccion">Nombre del Cooperante</div>
                      <b>{{donante.nombre}}</b>
                      <br>

                    <div class="subtitulo_seccion">Descripción</div>
                      {{donante.descripcion|safe}}
                      <br>
                    {%if donante.website%}
                    <div class="subtitulo_seccion">Sitio Web</div>
                      {{donante.website}}
                      <br>
                      {%endif%}
                      <br>

                        <div class="seccion">
                            <div class="titulo_seccion izq">Lista de proyectos</div>
                        </div>
                                <table class="tabla_proyecto" id="tabla_lugares">
                                <tr>
                                    <th>Proyectos</th>
                                    <th>Estado</th>
                                    <th>Finalidad</th>
                                </tr>
                                {%for proyecto in proyectos%}
                                <tr>
                                    <td><a href="/proyecto/{{proyecto.id}}">{{proyecto.nombre}}</a></td>
                                    <td>{{proyecto.avance}}</td>
                                    <td>
                                        {%for tipo in proyecto.tipos.all%}
                                            {{tipo}},
                                        {%endfor%}
                                    </td>
                                </tr>

                                {%endfor%}
                             </table>

                        <div class="seccion">
                            <div class="titulo_seccion izq">Mapa de ubicación de proyectos</div>
                        </div>
                             <div id="map" class="smallmap"></div>
                   </div>


 {% endblock %}
